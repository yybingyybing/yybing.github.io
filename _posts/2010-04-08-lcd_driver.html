---
title: 基于Linux内核的OMAP3530 LCD屏驱动调试小记
tags: LCD C C++ driver linux
categories: driver
---

<p>背景：</p>
<p>　　　公司要在
OMAP3530平台上做产品，现在处于技术调查阶段。需求点之一是修改现有的3寸LCD屏为7寸屏。</p>
<p>问题：</p>
<p>　　　我们使用
的是瑞泰提供的开发板，开发文档中有关于屏使用的介绍。按照文档中提供的内核编译选项，找到对应的LCD屏驱动文件后，进行参数设定，没有效果，（最明显
的一个参数是时钟频率，修改后，应当花屏，事实上是还正常显示）。</p>

<p>解决过程：</p>
<p>1、把参数都改乱测试，没有效果，怀疑修改错文
件。</p>
<p>2、取消模块向DSS系统的注册动作，屏幕变黑，说明所修改文件还是起作用的。</p>
<p>3、找瑞泰技术支持询问，没有得到有用的
答案，放弃使用询问技术支持的权利。</p>
<p>4、OMAP相关技术群里寻找有这方面经验的人，提供参考意见，有经验的人都说改那文件的参数就起作用
的，见鬼了。</p>
<p>5、联机调内核，跟踪代码试试。结果联机调很麻烦，配了半天环境没配成，放弃此方案。</p>
<p>6、使用最古老的打LOG
方式，在相关地方都打上调试信息的输出，配合SourceInsigh查看代码的调用流程，最终找到了问题所在。</p>
<p>问题原因：</p>
<p>　
　内核启动时，给omapfb模块传入了显示设置的参数470×272MR-16@60，显示子系统(DSS)解析此参数，并对所显示结构体中的
panel-&gt;timings成品进行赋值，而此成员的值便是瑞泰文档中所提到的驱动文件中设定的，因此无论在该文件如何修改参数，系统都能正常显
示。</p>
<p>修改方案：</p>
<p>　　修改解析参数并给display-&gt;panel-&gt;timings赋值的地方，取消赋值操
作。</p>
<p>方案验证：</p>
<p>　　修注释掉该调用后，系统直接崩溃。</p>
<p>新问题调查：</p>
<p>　　定位出问题的代码行后，
发现我们的参数在设置时，超出了合法范围，改小该值，并使用示波器测试时钟频率和相应信号与在驱动文件中设定的值相同。问题最终解决，总共使用时间七个工
作日。</p>